<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Rafiki-√âcolier</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. COULEURS ET VARIABLES GLOBALES --- */
        :root {
            --background-gradient: linear-gradient(109.6deg, rgba(179,9,23,1) 11.2%, rgba(226,181,49,1) 91.1%);
            --glass-panel-bg: rgba(255, 255, 255, 0.15); /* Transparence pour le panneau central */
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            --glass-blur: blur(20px);
            --text-light: #f0f0f0;
            --text-dark-glass: #333; /* Pour le texte sur fond clair dans le glass */
            --input-bg: rgba(255, 255, 255, 0.2);
            --input-border: 1px solid rgba(255, 255, 255, 0.3);
            --input-placeholder: rgba(255, 255, 255, 0.7);
            --button-send-bg: rgba(255, 255, 255, 0.8);
            --button-send-icon: #e2b531; /* Couleur de l'ic√¥ne d'envoi */
            --chat-bubble-bg-bot: rgba(255, 255, 255, 0.9);
            --chat-bubble-bg-user: rgba(255, 255, 255, 0.3);
            --chat-bubble-text-bot: #333;
            --chat-bubble-text-user: #fff;
            --suggestion-bg: rgba(255, 255, 255, 0.2);
            --suggestion-border: 1px solid rgba(255, 255, 255, 0.3);
            --suggestion-hover: rgba(255, 255, 255, 0.4);
            --shadow-soft: 0 8px 30px rgba(0, 0, 0, 0.2);
            --border-radius-large: 20px;
            --border-radius-small: 12px;
            --animation-duration: 0.3s;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--background-gradient);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* Pr√©vient les barres de d√©filement du body */
            line-height: 1.6;
        }

        /* --- 2. CONTENEUR GLOBAL DU CHATBOT (Panneau central Alena AI) --- */
        .chatbot-wrapper {
            background: var(--glass-panel-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-soft);
            max-width: 900px; /* Plus large pour accueillir le contenu */
            width: 90%;
            height: 90vh; /* Hauteur fixe pour le d√©filement */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Cache le contenu qui d√©passe */
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            animation: fadeInSlideUp var(--animation-duration) forwards ease-out;
        }

        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- 3. EN-T√äTE DU CHATBOT --- */
        .chat-header {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--glass-border);
            flex-shrink: 0; /* Emp√™che de r√©tr√©cir */
        }
        .chat-header .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 0.5px;
        }
        .chat-header .close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.8rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity var(--animation-duration);
        }
        .chat-header .close-btn:hover { opacity: 1; }

        /* --- 4. ZONE DE BIENVENUE / IC√îNE CENTRALE --- */
        .welcome-center {
            flex-grow: 1; /* Prend l'espace restant */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            gap: 15px;
            opacity: 1; /* Visible par d√©faut */
            transition: opacity var(--animation-duration);
        }
        .welcome-center.hidden { opacity: 0; height: 0; overflow: hidden; padding: 0;} /* Cach√© quand le chat d√©marre */

        .center-icon {
            font-size: 6rem; /* Grande ic√¥ne centrale */
            animation: pulse 2s infinite ease-in-out;
            margin-bottom: 20px;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .welcome-text {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        .initial-prompt-suggestions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .initial-prompt-suggestions button {
            background: rgba(255, 255, 255, 0.2);
            border: var(--glass-border);
            border-radius: var(--border-radius-small);
            color: var(--text-light);
            padding: 10px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color var(--animation-duration);
        }
        .initial-prompt-suggestions button:hover {
            background: rgba(255, 255, 255, 0.3);
        }


        /* --- 5. ZONE DE DISCUSSION (MESSAGES) --- */
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth; /* D√©filement doux */
        }
        .chat-messages.hidden { display: none; } /* Cach√© initialement */


        .chat-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: var(--border-radius-small);
            line-height: 1.5;
            font-size: 0.95rem;
            word-wrap: break-word; /* Casse les mots longs */
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            animation: fadeIn var(--animation-duration) ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-bubble.bot {
            background-color: var(--chat-bubble-bg-bot);
            color: var(--chat-bubble-text-bot);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .chat-bubble.user {
            background-color: var(--chat-bubble-bg-user);
            color: var(--chat-bubble-text-user);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            backdrop-filter: var(--glass-blur); /* Un peu de glassmorphism sur les bulles user */
            -webkit-backdrop-filter: var(--glass-blur);
        }

        /* Loader dans les bulles */
        .chat-bubble .loader {
            border: 3px solid rgba(226,181,49, 0.2); /* Plus discret */
            border-top: 3px solid var(--button-send-icon);
            width: 20px;
            height: 20px;
            margin: 0;
            display: inline-block; /* Align√© avec le texte */
            vertical-align: middle;
            margin-right: 8px;
        }

        /* --- 6. BARRE DE SAISIE DU PROMPT EN BAS --- */
        .chat-input-area {
            flex-shrink: 0; /* Emp√™che de r√©tr√©cir */
            padding: 20px 30px;
            border-top: var(--glass-border);
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--glass-panel-bg); /* Maintient le glassmorphism en bas */
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .prompt-input-bottom {
            flex-grow: 1;
            background: var(--input-bg);
            border: var(--input-border);
            border-radius: var(--border-radius-small);
            padding: 12px 18px;
            font-size: 1rem;
            color: var(--text-light);
            outline: none;
            transition: all var(--animation-duration);
        }
        .prompt-input-bottom::placeholder {
            color: var(--input-placeholder);
        }
        .prompt-input-bottom:focus {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .send-button-bottom {
            background: var(--button-send-bg);
            border: none;
            border-radius: 50%; /* Bouton rond */
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform var(--animation-duration), background-color var(--animation-duration);
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .send-button-bottom:hover {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .send-button-bottom:active {
            transform: scale(0.95);
        }
        .send-button-bottom i {
            color: var(--button-send-icon); /* Couleur de l'ic√¥ne */
            font-size: 1.2rem;
        }
        .send-button-bottom:disabled {
            background-color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        /* --- 7. SUGGESTIONS DE PROMPT EN BAS --- */
        .bottom-suggestions {
            flex-shrink: 0;
            padding: 10px 30px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            border-top: var(--glass-border);
            background: var(--glass-panel-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }
        .bottom-suggestions.hidden { display: none; }

        .suggestion-chip {
            background: var(--suggestion-bg);
            border: var(--suggestion-border);
            border-radius: 20px;
            color: var(--text-light);
            padding: 8px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--animation-duration);
            white-space: nowrap; /* Emp√™che le texte de se briser */
        }
        .suggestion-chip:hover {
            background: var(--suggestion-hover);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* --- 8. MEDIA QUERIES pour la Responsivit√© --- */
        @media (max-width: 768px) {
            .chatbot-wrapper {
                width: 95%;
                height: 95vh;
            }
            .chat-header, .chat-input-area, .bottom-suggestions {
                padding: 15px 20px;
            }
            .chat-messages {
                padding: 15px 20px;
            }
            .chat-header .logo {
                font-size: 1.2rem;
            }
            .chat-header .close-btn {
                font-size: 1.5rem;
            }
            .welcome-text {
                font-size: 1.1rem;
            }
            .center-icon {
                font-size: 5rem;
            }
        }

        @media (max-width: 480px) {
            .chatbot-wrapper {
                width: 100%;
                height: 100vh;
                border-radius: 0; /* Plein √©cran sur mobile */
            }
            .chat-header, .chat-input-area, .bottom-suggestions, .chat-messages {
                padding: 10px 15px;
            }
            .chat-bubble {
                font-size: 0.9rem;
                padding: 10px 15px;
            }
            .send-button-bottom {
                width: 40px;
                height: 40px;
            }
            .send-button-bottom i {
                font-size: 1rem;
            }
            .welcome-text {
                font-size: 1rem;
            }
            .initial-prompt-suggestions button {
                font-size: 0.8rem;
                padding: 8px 12px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="chatbot-wrapper">
        <div class="chat-header">
            <span class="logo">Rafiki AI <span style="font-size: 0.8em; opacity: 0.7;">BETA</span></span>
            <button class="close-btn" onclick="toggleChatbot()">‚úï</button>
        </div>

        <div id="welcomeCenter" class="welcome-center">
            <div class="center-icon">üß†</div>
            <p class="welcome-text">Que voulez-vous savoir sur l'IA ?</p>
            <div class="initial-prompt-suggestions">
                <button onclick="sendSuggestedPrompt(this)">C'est quoi un algorithme de tri ?</button>
                <button onclick="sendSuggestedPrompt(this)">Comment Java est-il diff√©rent de JavaScript ?</button>
                <button onclick="sendSuggestedPrompt(this)">Quelles sont les bases de la programmation ?</button>
            </div>
        </div>

        <div id="chatMessages" class="chat-messages hidden">
            </div>

        <div class="chat-input-area">
            <input type="text" id="promptInput" class="prompt-input-bottom" placeholder="Demandez quelque chose..." onkeypress="handleEnter(event)">
            <button id="sendButton" class="send-button-bottom" onclick="sendPrompt()">
                <i class="fas fa-paper-plane"></i> </button>
        </div>

        <div id="bottomSuggestions" class="bottom-suggestions hidden">
            <span class="suggestion-chip" onclick="sendSuggestedPrompt(this)">Qu'est-ce que le Machine Learning ?</span>
            <span class="suggestion-chip" onclick="sendSuggestedPrompt(this)">Expliquez-moi le concept de variable.</span>
            <span class="suggestion-chip" onclick="sendSuggestedPrompt(this)">Donnez un exemple de code Python.</span>
        </div>
    </div>

    <script>
        // --- LOGIQUE JAVASCRIPT (Connexion Gemini) ---
        // VEUILLEZ REMPLACER PAR VOTRE CL√â API GEMINI VALIDE !
        const GEMINI_API_KEY = "AIzaSyBz3Yq6tqhklSNbUS8Ae4lVIyzXIIA4k7k"; 
        const PROMPT_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;

        const welcomeCenter = document.getElementById('welcomeCenter');
        const chatMessages = document.getElementById('chatMessages');
        const promptInput = document.getElementById('promptInput');
        const sendButton = document.getElementById('sendButton');
        const bottomSuggestions = document.getElementById('bottomSuggestions');

        // Initialisation de l'√©tat du chat
        let chatStarted = false; 

        function toggleChatbot() {
            // Pour l'instant, la "fermeture" efface le chat et r√©initialise.
            // En production, on pourrait le masquer.
            if (chatStarted) {
                chatMessages.innerHTML = '';
                chatMessages.classList.add('hidden');
                welcomeCenter.classList.remove('hidden');
                bottomSuggestions.classList.add('hidden');
                chatStarted = false;
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendPrompt();
        }

        async function sendPrompt(suggestedText = null) {
            const userPrompt = suggestedText || promptInput.value.trim();
            if (!userPrompt) return;

            // Masquer le centre de bienvenue si c'est le premier message
            if (!chatStarted) {
                welcomeCenter.classList.add('hidden');
                chatMessages.classList.remove('hidden');
                bottomSuggestions.classList.remove('hidden'); // Afficher les suggestions du bas
                chatStarted = true;
            }

            // Ajouter la bulle de l'utilisateur
            addMessage(userPrompt, 'user');
            promptInput.value = ''; // Effacer l'input

            // D√©sactiver l'input et le bouton pendant la requ√™te
            promptInput.disabled = true;
            sendButton.disabled = true;

            // Ajouter la bulle de l'IA avec un loader
            const botMessageElement = addMessage('', 'bot', true); // true pour montrer le loader
            
            try {
                const response = await fetch(PROMPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {text: `Tu es un tuteur IA tr√®s enthousiaste et p√©dagogue pour des jeunes √©tudiants en informatique de Rafiki √âcolier. Ton but est de les passionner pour la technologie et le code. R√©ponds de mani√®re concise, pr√©cise, encourageante, et utilise des exemples concrets ou des emojis pertinents. Si la question n'est pas claire, demande plus de pr√©cisions avec gentillesse. R√©ponds √† la question suivante : ${userPrompt}`}
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erreur API Gemini: ${response.status} - ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Remplacer le loader par la r√©ponse avec l'effet "machine √† √©crire"
                typeWriterEffect(botMessageElement, aiResponse);

            } catch (error) {
                console.error("Erreur Gemini API:", error);
                // G√©rer l'erreur dans la bulle de l'IA
                typeWriterEffect(botMessageElement, "D√©sol√©, une erreur est survenue lors de la connexion √† Gemini. V√©rifiez votre cl√©, votre console, ou votre quota d'utilisation.");
            } finally {
                // R√©activer l'input et le bouton apr√®s la requ√™te
                promptInput.disabled = false;
                sendButton.disabled = false;
                promptInput.focus(); // Remettre le focus
            }
        }

        function addMessage(text, sender, showLoader = false) {
            const div = document.createElement('div');
            div.className = `chat-bubble ${sender}`;
            if (showLoader) {
                div.innerHTML = `<div class="loader"></div>`;
            } else {
                div.innerText = text;
            }
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll automatique
            return div; // Retourne l'√©l√©ment pour y ajouter le texte plus tard
        }

        function typeWriterEffect(element, text) {
            element.innerHTML = ''; // Nettoyer le contenu (enlever le loader)
            element.style.animation = 'none'; // D√©sactiver l'animation fadeIn si elle est sur la bulle
            element.classList.remove('typing-text'); // Enlever la classe de typing pour ne pas avoir de double curseur
            
            let i = 0;
            const speed = 25; // Vitesse de frappe en ms

            // Ajouter le curseur clignotant au texte g√©n√©r√©
            const textSpan = document.createElement('span');
            textSpan.classList.add('typing-text');
            element.appendChild(textSpan);

            function type() {
                if (i < text.length) {
                    textSpan.innerHTML += text.charAt(i);
                    i++;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    setTimeout(type, speed);
                } else {
                    // Retirer l'animation de clignotement apr√®s la fin
                    textSpan.style.borderRight = 'none';
                    textSpan.style.animation = 'none';
                }
            }
            type();
        }

        // Fonction pour envoyer un prompt sugg√©r√©
        function sendSuggestedPrompt(button) {
            const text = button.innerText;
            sendPrompt(text);
        }

        // Gestion de la "fermeture" du chatbot (pour la d√©mo, r√©initialise)
        function toggleChatbot() {
            chatMessages.innerHTML = '';
            welcomeCenter.classList.remove('hidden');
            chatMessages.classList.add('hidden');
            bottomSuggestions.classList.add('hidden');
            chatStarted = false;
            promptInput.value = '';
            promptInput.disabled = false;
            sendButton.disabled = false;
            promptInput.focus();
        }

        // Ajouter une bulle de bienvenue au d√©marrage (pour un historique)
        function addInitialBotMessage() {
            if (!chatStarted) { // Ajoute seulement si le chat n'a pas commenc√©
                 const botMessageElement = addMessage('', 'bot');
                 typeWriterEffect(botMessageElement, "Bonjour ! Je suis Rafiki AI, votre tuteur intelligent. Posez-moi vos questions sur le code pour commencer ! üöÄ");
            }
        }
        // Pour une d√©mo, on peut d√©cider de ne pas avoir de message initial dans les bulles mais juste le welcome-center.
        // Si vous voulez un message initial dans les bulles, d√©commentez ceci :
        // setTimeout(addInitialBotMessage, 500); // D√©lai pour l'animation d'entr√©e
        
    </script>
</body>
</html>
